
> **Papel:** VocÃª Ã© um engenheiro full-stack sÃªnior e um UX/UI designer experiente. Entregue um sistema profissional, seguro, performÃ¡tico e com design premium, pronto para uso em produÃ§Ã£o.
>
> **Objetivo:** Criar uma **plataforma de agÃªncia 360Â° especializada em e-commerce e CRM de vendas**, onde Ã© possÃ­vel gerenciar **lojas, produtos, pedidos, clientes, campanhas de marketing, automaÃ§Ãµes de vendas e faturamento** em um Ãºnico sistema.
>
> **DescriÃ§Ã£o geral:**
> A aplicaÃ§Ã£o deve permitir que administradores e clientes da agÃªncia acompanhem todo o funil comercial â€” desde a aquisiÃ§Ã£o do lead atÃ© a conversÃ£o em venda e o faturamento â€” integrando dados de campanhas, estoque, pedidos, pagamentos e performance de vendas.
>
> ---
>
> ### âš™ï¸ **Requisitos tÃ©cnicos (inclui pagamentos)**
>
> **1. AutenticaÃ§Ã£o e usuÃ¡rios**
>
> * Login, cadastro e recuperaÃ§Ã£o de senha usando **Supabase Auth**.
> * NÃ­veis de acesso: **Administrador (agÃªncia)** e **Cliente (lojista)**.
>
> **2. Painel administrativo (para agÃªncia)**
>
> * Dashboard com mÃ©tricas (vendas, pedidos, faturamento, leads, ROI).
> * CRUD de clientes (lojistas), produtos, campanhas e planos.
> * HistÃ³rico de pagamentos e faturas.
>
> **3. Painel do cliente (lojista)**
>
> * GestÃ£o de pedidos, produtos, estoque, clientes (CRM) e faturamento.
> * CriaÃ§Ã£o de cobranÃ§as (pagamentos Ãºnicos) e planos de assinatura (se aplicÃ¡vel).
> * VisualizaÃ§Ã£o do status de pagamento e recibos.
>
> **4. MÃ³dulo CRM de Vendas**
>
> * Leads, funil drag-and-drop, histÃ³rico de interaÃ§Ãµes e tarefas.
> * AutomaÃ§Ã£o para enviar cobranÃ§as quando um pedido Ã© concluÃ­do.
>
> **5. Pagamentos via script (implementaÃ§Ã£o exigida)**
>
> * Implementar **scripts de pagamento** para os mÃ©todos: **Pix, cartÃ£o de crÃ©dito e boleto** usando **MercadoPago**, **Stripe** e **Asaas** (ou combinaÃ§Ã£o conforme melhor ajuste).
> * Cada script deve:
>
>   * Gerar cobranÃ§a a partir do pedido / fatura (valor, cliente, descriÃ§Ã£o, idempotency key).
>   * Retornar a URL de checkout (ou dados de pagamento Pix â€” QR code/copia e cola).
>   * Persistir transaÃ§Ã£o no banco (Supabase) com status inicial `pending`.
> * **Webhooks:** criar endpoints serverless para receber notificaÃ§Ãµes (payment succeeded, failed, refunded). Webhooks devem validar assinaturas (secret) e atualizar o status da transaÃ§Ã£o/ordem.
> * **Recibos e faturas:** gerar PDF/CSV de recibos automaticamente apÃ³s pagamento confirmado; enviar por e-mail.
> * **SeguranÃ§a e conformidade:** usar chaves secretas no ambiente (never expose in frontend), usar idempotency keys e validar montantes no webhook para evitar fraudes.
> * **Ambientes de testes:** incluir scripts/configuraÃ§Ãµes para usar os ambientes de sandbox/test da MercadoPago/Stripe/Asaas.
> * **Retry & idempotÃªncia:** lÃ³gica para reprocessamento seguro de webhooks e tentativas limitadas.
>
> **6. RelatÃ³rios e mÃ©tricas**
>
> * GrÃ¡ficos com Recharts (vendas por perÃ­odo, conversÃ£o por campanha, receita recorrente).
> * Filtros por data, loja e categoria; exportaÃ§Ã£o CSV/PDF.
>
> **7. AutomaÃ§Ã£o e integraÃ§Ãµes**
>
> * Placeholders e conectores para Shopify, Mercado Livre, Meta Ads e Google Ads.
> * IntegraÃ§Ã£o com Brevo para e-mail e Twilio/Zenvia para WhatsApp.
> * Webhooks para sincronizar pedidos e pagamentos entre sistemas.
>
> ---
>
> ### ğŸ’» **Stack recomendada e detalhes de implementaÃ§Ã£o**
>
> * **Frontend:** React + TypeScript + Tailwind CSS + Vite. Implementar fluxo de checkout que chama o endpoint `/api/create-payment` e redireciona para checkout (ou exibe QR Pix).
> * **Backend:** Supabase (Auth, Database, Storage, Functions) + serverless functions (Vercel / Supabase Functions) para rotas de pagamento e webhooks.
> * **Pagamentos (exemplos):**
>
>   * **MercadoPago:** criar `createMercadoPagoPayment(order)` que retorna `init_point` (checkout) ou `qr_code` para Pix; endpoint `/api/webhook/mercadopago`.
>   * **Stripe:** usar Payment Intents / Checkout Sessions; endpoint `/api/webhook/stripe` para `checkout.session.completed`.
>   * **Asaas:** para Pix e boletos via Asaas API, com webhook `/api/webhook/asaas`.
> * **Banco:** Supabase PostgreSQL para armazenar `orders`, `payments`, `invoices`, `webhook_events`.
> * **GrÃ¡ficos:** Recharts.
> * **Deploy:** Vercel / Netlify (frontend) + Supabase functions (backend) ou Vercel Serverless Functions.
>
> ---
>
> ### ğŸ” **Boas prÃ¡ticas de seguranÃ§a**
>
> * Nunca expor chaves secretas no frontend.
> * Validar todas as notaÃ§Ãµes de webhook com assinatura HMAC.
> * Usar idempotency keys nas solicitaÃ§Ãµes de pagamento.
> * Registrar logs de webhook e auditoria de transaÃ§Ãµes.
>
> ---
>
> ### ğŸ§¾ **Funcionalidades extra (opcionais, mas desejÃ¡veis)**
>
> * Planos de assinatura com cobranÃ§a recorrente (Stripe Subscriptions).
> * Dashboard de conciliaÃ§Ã£o de pagamentos (mostrar pagamentos pendentes vs confirmados).
> * IntegraÃ§Ã£o com gateway fiscal ou geraÃ§Ã£o de nota fiscal (placeholder).
>
> ---
>
> ### ğŸ“˜ **DocumentaÃ§Ã£o e entrega**
>
> * CÃ³digo modular e comentado: mÃ³dulos `payments`, `orders`, `crm`, `reports`.
> * Exemplos / scripts de seed para criar pedidos e simular pagamentos em sandbox.
> * Guia de deploy e instruÃ§Ãµes para configurar chaves de API, webhooks e ambiente.
>
> ---
>
> **Resultado esperado:** Uma aplicaÃ§Ã£o web profissional e funcional, com checkout integrado via scripts (MercadoPago, Stripe, Asaas), webhooks confiÃ¡veis e fluxo completo de pedido â†’ cobranÃ§a â†’ confirmaÃ§Ã£o â†’ recibo, pronta para ser usada por lojas e clientes da agÃªncia.